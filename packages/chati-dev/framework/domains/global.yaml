# Global Domain â€” Coding standards, bracket behavior, mode constraints
# Injected by PRISM L1 layer

rules:
  - id: code-english
    text: "All code, comments, and variable names must be in English."
    priority: high

  - id: code-conventions
    text: "Follow existing codebase conventions. Check patterns before creating new ones."
    priority: normal

  - id: artifacts-english
    text: "All artifacts (PRD, architecture docs, task definitions) must be in English."
    priority: high

  - id: interaction-lang
    text: "Interact with user in their preferred language. Artifacts stay in English."
    priority: normal

  # Execution Profile Rules (v3.0.0)
  execution-profiles:
    - explore-readonly: "In explore profile, all write/edit tool calls are blocked."
      priority: critical
    - guided-confirmation: "In guided profile, significant writes require user confirmation."
      priority: high
    - autonomous-gate-check: "Autonomous profile requires cumulative gate scores >= 90%."
      priority: critical
    - profile-downgrade: "If quality drops below threshold during autonomous execution, auto-downgrade to guided."
      priority: critical

  # Multi-CLI Rules (v3.0.0)
  multi-cli:
    - primary-provider: "Claude is the default and primary provider. Multi-CLI is opt-in."
      priority: high
    - provider-validation: "Health check validates provider availability before spawning."
      priority: high
    - provider-model-map: "Each provider has its own model map. Agent assignments reference tier (opus/sonnet/haiku) which maps to provider-specific models."
      priority: normal

modes:
  planning:
    writeScope: "chati.dev/"
    allowedActions:
      - read_any_file
      - write_chati_dev_only
      - create_artifacts
      - run_analysis
    blockedActions:
      - modify_project_code
      - run_destructive_commands
      - deploy

  build:
    writeScope: "*"
    allowedActions:
      - read_any_file
      - write_any_file
      - run_tests
      - run_linting
      - git_operations
    blockedActions:
      - deploy_to_production
      - modify_infrastructure

  deploy:
    writeScope: "*"
    allowedActions:
      - read_any_file
      - write_any_file
      - deploy_to_production
      - modify_infrastructure
      - run_tests
    blockedActions: []

brackets:
  FRESH:
    behavior: "Full context injection. All layers active. Include detailed rules and examples."
  MODERATE:
    behavior: "Standard injection. Skip task detail layer (L4). Summarize long rules."
  DEPLETED:
    behavior: "Minimal injection. Only L0+L1+L2. Use rule IDs instead of full text."
  CRITICAL:
    behavior: "Emergency. L0+L1 only. Trigger handoff advisory. Preserve essential state."
